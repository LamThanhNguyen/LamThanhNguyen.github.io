<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>I. 12 Key Design Pattern In MongoDB With Real World Use Case | Liam Blogs</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="description" content="12 Key Design Pattern in MongoDB">
    <meta name="generator" content="Hugo 0.147.9">
    
    
    
      <meta name="robots" content="index, follow">
    
    

    
<link rel="stylesheet" href="/ananke/css/main.min.8d048772ae72ab11245a0e296d1f2a36d3e3dd376c6c867394d6cc659c68fc37.css" >




    


    
      
<link rel="shortcut icon" href="/images/favicon_logo.webp" type="image/x-icon" />


    

    

    
      <link rel="canonical" href="https://lamthanhnguyen.github.io/database/12-key-design-pattern-in-mongodb-with-real-world-use-case/">
    

    <meta property="og:url" content="https://lamthanhnguyen.github.io/database/12-key-design-pattern-in-mongodb-with-real-world-use-case/">
  <meta property="og:site_name" content="Liam Blogs">
  <meta property="og:title" content="I. 12 Key Design Pattern In MongoDB With Real World Use Case">
  <meta property="og:description" content="12 Key Design Pattern in MongoDB">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="database">
    <meta property="article:published_time" content="2025-06-20T00:00:00+00:00">
    <meta property="article:modified_time" content="2025-06-20T00:00:00+00:00">
    <meta property="article:tag" content="Mongodb">
    <meta property="article:tag" content="Nosql">
    <meta property="article:tag" content="Design Pattern">

  <meta itemprop="name" content="I. 12 Key Design Pattern In MongoDB With Real World Use Case">
  <meta itemprop="description" content="12 Key Design Pattern in MongoDB">
  <meta itemprop="datePublished" content="2025-06-20T00:00:00+00:00">
  <meta itemprop="dateModified" content="2025-06-20T00:00:00+00:00">
  <meta itemprop="wordCount" content="2747">
  <meta itemprop="keywords" content="Mongodb,Nosql,Design Pattern">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="I. 12 Key Design Pattern In MongoDB With Real World Use Case">
  <meta name="twitter:description" content="12 Key Design Pattern in MongoDB">

      
    
	
  </head><body class="ma0 avenir bg-near-white production">

    
   
  

  
  
  
  <header class="cover bg-center" style="background-image: url('https://lamthanhnguyen.github.io/images/12-key-design-pattern-mongodb.png');">
    <div class="bg-black-60">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l center items-center justify-between">
    <a href="/" class="f3 fw2 hover-white white-90 dib no-underline">
      
        Liam Blogs
      
    </a>
    <div class="flex-l items-center">
      

      
        <ul class="pl0 mr3">
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white white-90 no-underline" href="/about/" title="About page">
              About
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white white-90 no-underline" href="/aws/" title="AWS page">
              AWS
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white white-90 no-underline" href="/database/" title="Database page">
              Database
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white white-90 no-underline" href="/kubernetes/" title="Kubernetes page">
              Kubernetes
            </a>
          </li>
          
        </ul>
      
      <div class="ananke-socials"><a href="http://linkedin.com/in/lam-thanh-nguyen-abcd6789" target="_blank" rel="noopener"
        class="ananke-social-link link-transition linkedin link dib z-999 pt3 pt0-l mr1"
        title="follow on LinkedIn - Opens in a new window"
        aria-label="follow on LinkedIn - Opens in a new window">
      <span class="icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc. --><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>
            
          </span></a></div>

    </div>
  </div>
</nav>

      <div class="tc-l pv6 ph3 ph4-ns">
        
          <div class="f2 f1-l fw2 white-90 mb0 lh-title">I. 12 Key Design Pattern In MongoDB With Real World Use Case</div>
          
            <div class="fw1 f5 f3-l white-80 measure-wide-l center lh-copy mt3 mb4">
              12 Key Design Pattern in MongoDB
            </div>
          
        
      </div>
    </div>
  </header>



    <main class="pb7" role="main">
      
  
  
  <article class="flex-l mw8 center ph3 flex-wrap justify-between">
    <header class="mt4 w-100">
      <aside class="instapaper_ignoref b helvetica tracked ttu">
          
        Database
      </aside><div id="sharing" class="mt3 ananke-socials"><a href="https://www.linkedin.com/shareArticle?&amp;mini=true&amp;source=https%3A%2F%2Flamthanhnguyen.github.io%2Fdatabase%2F12-key-design-pattern-in-mongodb-with-real-world-use-case%2F&amp;summary=Introduction&#43;MongoDB&#43;provides&#43;a&#43;variety&#43;of&#43;design&#43;patterns&#43;to&#43;help&#43;you&#43;model&#43;data&#43;efficiently&#43;for&#43;real-world&#43;use&#43;cases.&#43;Below&#43;are&#43;12&#43;key&#43;patterns&#43;every&#43;developer&#43;should&#43;know%2C&#43;each&#43;illustrated&#43;with&#43;practical&#43;examples.%0A1.&#43;Attribute&#43;Pattern&#43;Scenario%3A&#43;An&#43;online&#43;store&#43;has&#43;multiple&#43;product&#43;categories%2C&#43;such&#43;as&#43;smartphones%2C&#43;laptops%2C&#43;and&#43;clothing.&#43;Each&#43;category&#43;contains&#43;items&#43;with&#43;a&#43;wide&#43;range&#43;of&#43;attributes.&#43;For&#43;example%3A%0ASmartphones%3A&#43;screen&#43;size%2C&#43;battery&#43;capacity%2C&#43;camera&#43;resolution%2C&#43;etc.&#43;Laptops%3A&#43;processor&#43;type%2C&#43;RAM&#43;size%2C&#43;storage&#43;type%2C&#43;etc.&#43;Clothing%3A&#43;size%2C&#43;color%2C&#43;material%2C&#43;etc.&#43;Due&#43;to&#43;the&#43;variability&#43;and&#43;unpredictability&#43;of&#43;these&#43;attributes%2C&#43;using&#43;a&#43;rigid&#43;schema&#43;is&#43;inefficient.%0A&amp;title=I.&#43;12&#43;Key&#43;Design&#43;Pattern&#43;In&#43;MongoDB&#43;With&#43;Real&#43;World&#43;Use&#43;Case&amp;url=https%3A%2F%2Flamthanhnguyen.github.io%2Fdatabase%2F12-key-design-pattern-in-mongodb-with-real-world-use-case%2F"
        class="ananke-social-link linkedin no-underline"
        title="Share on LinkedIn" aria-label="Share on LinkedIn"
        target="_blank" rel="nofollow noopener noreferrer">
        <span class="icon">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc. --><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>
                
              </span></a></div>
<h1 class="f1 athelas mt3 mb1">I. 12 Key Design Pattern In MongoDB With Real World Use Case</h1>
      
      
      
      <time class="f6 mv4 dib tracked" datetime="2025-06-20T00:00:00Z">June 20, 2025</time>
      

      
      
    </header>
    <div class="nested-copy-line-height lh-copy serif f4 nested-links mid-gray pr4-l w-two-thirds-l"><h1 id="introduction">Introduction</h1>
<p>MongoDB provides a variety of design patterns to help you model data efficiently for real-world use cases. Below are 12 key patterns every developer should know, each illustrated with practical examples.</p>
<h2 id="1-attribute-pattern">1. Attribute Pattern</h2>
<h3 id="scenario">Scenario:</h3>
<p>An online store has multiple product categories, such as smartphones, laptops, and clothing. Each category contains items with a wide range of attributes. For example:</p>
<ul>
<li>Smartphones: screen size, battery capacity, camera resolution, etc.</li>
<li>Laptops: processor type, RAM size, storage type, etc.</li>
<li>Clothing: size, color, material, etc.</li>
</ul>
<p>Due to the variability and unpredictability of these attributes, using a rigid schema is inefficient.</p>
<h3 id="applying-the-attribute-pattern">Applying the Attribute Pattern:</h3>
<p>Instead of defining a schema with fixed fields, the attribute pattern suggests creating an array of key-value pairs within the product document. This approach simplifies schema management and provides flexibility.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;_id&#34;</span>: <span style="color:#e6db74">&#34;product123&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;iPhone 16&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;category&#34;</span>: <span style="color:#e6db74">&#34;Smartphones&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;price&#34;</span>: <span style="color:#ae81ff">1299</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;attributes&#34;</span>: [
</span></span><span style="display:flex;"><span>    {<span style="color:#f92672">&#34;k&#34;</span>: <span style="color:#e6db74">&#34;screen_size&#34;</span>, <span style="color:#f92672">&#34;v&#34;</span>: <span style="color:#e6db74">&#34;6.3 inches&#34;</span>},
</span></span><span style="display:flex;"><span>    {<span style="color:#f92672">&#34;k&#34;</span>: <span style="color:#e6db74">&#34;battery_capacity&#34;</span>, <span style="color:#f92672">&#34;v&#34;</span>: <span style="color:#e6db74">&#34;3500mAh&#34;</span>},
</span></span><span style="display:flex;"><span>    {<span style="color:#f92672">&#34;k&#34;</span>: <span style="color:#e6db74">&#34;camera_resolution&#34;</span>, <span style="color:#f92672">&#34;v&#34;</span>: <span style="color:#e6db74">&#34;48MP&#34;</span>},
</span></span><span style="display:flex;"><span>    {<span style="color:#f92672">&#34;k&#34;</span>: <span style="color:#e6db74">&#34;color&#34;</span>, <span style="color:#f92672">&#34;v&#34;</span>: <span style="color:#e6db74">&#34;Silver&#34;</span>}
</span></span><span style="display:flex;"><span>  ]
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">products</span>.<span style="color:#a6e22e">find</span>({
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">attributes</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">$elemMatch</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">k</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;screen_size&#34;</span>, <span style="color:#a6e22e">v</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;6.3 inches&#34;</span> }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>})
</span></span></code></pre></div><h3 id="advantages">Advantages:</h3>
<ul>
<li><strong>Flexible schema</strong>: Easily accommodates new attributes.</li>
<li><strong>Efficient querying</strong>: Facilitates searches based on various product specifications.</li>
<li><strong>Cleaner schema management</strong>: Simplifies maintenance and reduces complexity.</li>
</ul>
<p>This makes the <strong>Attribute Pattern</strong> an excellent choice for applications managing <em>diverse</em> and <em>unpredictable</em> data models.</p>
<h2 id="2-computed-pattern">2. Computed Pattern</h2>
<h3 id="scenario-1">Scenario:</h3>
<p>An online store wants to efficiently display the total amount for each customer order without having to recalculate it every time the order is viewed.</p>
<ul>
<li>Each order contains a list of products (items), with each product having a price and quantity.</li>
<li>The total order amount can be calculated as the sum of (price × quantity) for all items.</li>
</ul>
<h3 id="applying-the-computed-pattern">Applying the Computed Pattern:</h3>
<p>With the <strong>Computed Pattern</strong>, you store the computed field (e.g., totalAmount) directly in the order document, updating it only when the order changes (items are added/removed or quantities change).</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;_id&#34;</span>: <span style="color:#e6db74">&#34;order789&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;customerId&#34;</span>: <span style="color:#e6db74">&#34;customer123&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;items&#34;</span>: [
</span></span><span style="display:flex;"><span>    { <span style="color:#f92672">&#34;productId&#34;</span>: <span style="color:#e6db74">&#34;prod001&#34;</span>, <span style="color:#f92672">&#34;price&#34;</span>: <span style="color:#ae81ff">50</span>, <span style="color:#f92672">&#34;qty&#34;</span>: <span style="color:#ae81ff">2</span> },
</span></span><span style="display:flex;"><span>    { <span style="color:#f92672">&#34;productId&#34;</span>: <span style="color:#e6db74">&#34;prod002&#34;</span>, <span style="color:#f92672">&#34;price&#34;</span>: <span style="color:#ae81ff">30</span>, <span style="color:#f92672">&#34;qty&#34;</span>: <span style="color:#ae81ff">1</span> }
</span></span><span style="display:flex;"><span>  ],
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;totalAmount&#34;</span>: <span style="color:#ae81ff">130</span>  <span style="color:#75715e">// 50*2 + 30*1
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span></code></pre></div><h3 id="advantages-1">Advantages:</h3>
<ul>
<li><strong>Performance</strong>: Retrieving the total is instantaneous—no need to aggregate on the fly.</li>
<li><strong>Simplicity</strong>: Application logic is simplified; the value is always present.</li>
<li><strong>Scalability</strong>: Beneficial for analytics dashboards and reports that display many order totals at once.</li>
</ul>
<p>The <strong>Computed Pattern</strong> is ideal when you have data that is derived from other fields and you want fast, repeated access—such as <em>totals</em>, <em>averages</em>, or <em>scores</em>.</p>
<h2 id="3-bucket-pattern">3. Bucket Pattern</h2>
<h3 id="scenario-2">Scenario:</h3>
<p>Suppose you’re building an IoT application that collects temperature readings from thousands of sensors every few seconds. Each reading includes a timestamp, sensor ID, and the temperature value.</p>
<ul>
<li>Inserting each reading as a separate document quickly leads to millions of tiny documents, which is inefficient for both storage and querying.</li>
<li>Retrieving and analyzing readings for a specific period (for example, all readings from the last hour) becomes slow and costly.</li>
</ul>
<h3 id="applying-the-bucket-pattern">Applying the Bucket Pattern:</h3>
<p>With the <strong>Bucket Pattern</strong>, instead of storing each sensor reading as an individual document, you group multiple readings into a single “bucket” document—for example, all readings from one sensor within a specific hour.
Here, the document collects all temperature readings from sensorA between 14:00 and 15:00 on June 25, 2025:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;_id&#34;</span>: <span style="color:#e6db74">&#34;sensorA_2025-06-25T14&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;sensorId&#34;</span>: <span style="color:#e6db74">&#34;sensorA&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;date&#34;</span>: <span style="color:#e6db74">&#34;2025-06-25T14&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;readings&#34;</span>: [
</span></span><span style="display:flex;"><span>    { <span style="color:#f92672">&#34;timestamp&#34;</span>: <span style="color:#e6db74">&#34;2025-06-25T14:01:02Z&#34;</span>, <span style="color:#f92672">&#34;temperature&#34;</span>: <span style="color:#ae81ff">24.5</span> },
</span></span><span style="display:flex;"><span>    { <span style="color:#f92672">&#34;timestamp&#34;</span>: <span style="color:#e6db74">&#34;2025-06-25T14:03:45Z&#34;</span>, <span style="color:#f92672">&#34;temperature&#34;</span>: <span style="color:#ae81ff">24.7</span> },
</span></span><span style="display:flex;"><span>    { <span style="color:#f92672">&#34;timestamp&#34;</span>: <span style="color:#e6db74">&#34;2025-06-25T14:05:20Z&#34;</span>, <span style="color:#f92672">&#34;temperature&#34;</span>: <span style="color:#ae81ff">24.6</span> }
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// ... more readings within this hour
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  ]
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">sensor_readings</span>.<span style="color:#a6e22e">findOne</span>({
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">sensorId</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;sensorA&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">date</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;2025-06-25T14&#34;</span>
</span></span><span style="display:flex;"><span>})
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">sensor_readings</span>.<span style="color:#a6e22e">find</span>({
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">sensorId</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;sensorA&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">date</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">$gte</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;2025-06-25T14&#34;</span>, <span style="color:#a6e22e">$lte</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;2025-06-25T16&#34;</span> }
</span></span><span style="display:flex;"><span>})
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">sensor_readings</span>.<span style="color:#a6e22e">aggregate</span>([
</span></span><span style="display:flex;"><span>  { <span style="color:#a6e22e">$match</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">sensorId</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;sensorA&#34;</span>, <span style="color:#a6e22e">date</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;2025-06-25T14&#34;</span> } },
</span></span><span style="display:flex;"><span>  { <span style="color:#a6e22e">$unwind</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;$readings&#34;</span> },
</span></span><span style="display:flex;"><span>  { <span style="color:#a6e22e">$group</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">_id</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">null</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">avgTemperature</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">$avg</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;$readings.temperature&#34;</span> }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>])
</span></span></code></pre></div><h3 id="advantages-2">Advantages:</h3>
<ul>
<li><strong>Storage Efficiency</strong>: Fewer documents, reduced overhead.</li>
<li><strong>Query Performance</strong>: Fast retrieval of a range of readings for a time window.</li>
<li><strong>Aggregation</strong>: Easier to calculate statistics (like average temperature per hour).</li>
</ul>
<p>The <strong>Bucket Pattern</strong> is great for <em>time-series</em> data or any scenario with high-frequency, append-only events—like logs, metrics, or financial ticks—where grouping related records together in a single document optimizes performance and cost.</p>
<h2 id="4-schema-versioning-pattern">4. Schema Versioning Pattern</h2>
<h3 id="scenario-3">Scenario:</h3>
<p>Suppose you’re building a social networking app. As your product grows, you frequently add new features, such as a bio section, social links, or profile themes.
Over time, the user profile schema changes, but you want to maintain backward compatibility and avoid downtime for existing users.</p>
<ul>
<li><strong>Old user profiles</strong> may only have basic fields: <em>username</em>, <em>email</em>, and <em>createdAt</em>.</li>
<li><strong>New user profiles</strong> may include additional fields: <em>bio</em>, <em>avatar</em>, <em>socialLinks</em>, <em>theme</em>, etc.</li>
</ul>
<h3 id="applying-the-schema-versioning-pattern">Applying the Schema Versioning Pattern:</h3>
<p>You add a schemaVersion field to each profile document, which indicates the structure and fields used. When reading a document, your application can adjust its logic based on the version, and you can perform migrations as needed.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;_id&#34;</span>: <span style="color:#e6db74">&#34;user123&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;username&#34;</span>: <span style="color:#e6db74">&#34;bestuser&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;email&#34;</span>: <span style="color:#e6db74">&#34;bestuser@email.com&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;createdAt&#34;</span>: <span style="color:#e6db74">&#34;2023-05-01T10:00:00Z&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;schemaVersion&#34;</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;_id&#34;</span>: <span style="color:#e6db74">&#34;user456&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;username&#34;</span>: <span style="color:#e6db74">&#34;newbie&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;email&#34;</span>: <span style="color:#e6db74">&#34;newbie@email.com&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;createdAt&#34;</span>: <span style="color:#e6db74">&#34;2024-03-10T09:15:00Z&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;bio&#34;</span>: <span style="color:#e6db74">&#34;DevOps enthusiast&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;avatar&#34;</span>: <span style="color:#e6db74">&#34;https://example.com/avatar.png&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;theme&#34;</span>: <span style="color:#e6db74">&#34;dark&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;schemaVersion&#34;</span>: <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="advantages-3">Advantages:</h3>
<ul>
<li><strong>Backward Compatibility</strong>: Your app can read and handle old and new data formats.</li>
<li><strong>Safe Rollouts</strong>: You can roll out new features without disrupting existing data or users.</li>
<li><strong>Flexible Migrations</strong>: Migrate data in the background or on-demand, instead of requiring a “big bang” update.</li>
</ul>
<p>The <strong>Schema Versioning Pattern</strong> is ideal for applications that evolve quickly, need to support multiple data versions, or must migrate data gradually without breaking existing functionality.</p>
<h2 id="5-tree-pattern">5. Tree Pattern</h2>
<h3 id="scenario-4">Scenario:</h3>
<p>You’re running an online marketplace that sells many types of products. Products are organized into a <strong>hierarchical category tree</strong>:</p>
<ul>
<li>Electronics
<ul>
<li>Computers
<ul>
<li>Laptops</li>
<li>Desktops</li>
</ul>
</li>
<li>Smartphones</li>
</ul>
</li>
<li>Home &amp; Garden
<ul>
<li>Furniture</li>
<li>Kitchen</li>
</ul>
</li>
</ul>
<p>Each category may have subcategories, and subcategories may have their own children, forming a tree structure. You want to store and efficiently query this hierarchy in MongoDB.</p>
<h3 id="applying-the-tree-pattern">Applying the Tree Pattern:</h3>
<p>With the <strong>Tree Pattern</strong>, you represent each node (category) as a document that references its parent (and optionally its children). The most common approach is to store a parentId field in each category document.</p>
<p><strong>Parent Reference:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;_id&#34;</span>: <span style="color:#e6db74">&#34;electronics&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;Electronics&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;parentId&#34;</span>: <span style="color:#66d9ef">null</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;_id&#34;</span>: <span style="color:#e6db74">&#34;computers&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;Computers&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;parentId&#34;</span>: <span style="color:#e6db74">&#34;electronics&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;_id&#34;</span>: <span style="color:#e6db74">&#34;laptops&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;Laptops&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;parentId&#34;</span>: <span style="color:#e6db74">&#34;computers&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><strong>Child References:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;_id&#34;</span>: <span style="color:#e6db74">&#34;computers&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;Computers&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;children&#34;</span>: [<span style="color:#e6db74">&#34;laptops&#34;</span>, <span style="color:#e6db74">&#34;desktops&#34;</span>]
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><strong>Materialized Path:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;_id&#34;</span>: <span style="color:#e6db74">&#34;laptops&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;Laptops&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;path&#34;</span>: [<span style="color:#e6db74">&#34;electronics&#34;</span>, <span style="color:#e6db74">&#34;computers&#34;</span>, <span style="color:#e6db74">&#34;laptops&#34;</span>]
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><strong>Closure Table:</strong></p>
<p>Stores every ancestor–descendant pair in a separate collection.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{ <span style="color:#f92672">&#34;ancestor&#34;</span>: <span style="color:#e6db74">&#34;electronics&#34;</span>, <span style="color:#f92672">&#34;descendant&#34;</span>: <span style="color:#e6db74">&#34;laptops&#34;</span>, <span style="color:#f92672">&#34;depth&#34;</span>: <span style="color:#ae81ff">2</span> }
</span></span></code></pre></div><h3 id="advantages-4">Advantages:</h3>
<ul>
<li><strong>Flexible</strong>: Supports any number of levels in the hierarchy.</li>
<li><strong>Easy to Traverse</strong>: You can traverse up (find parent) or down (find children) using queries.</li>
<li><strong>Efficient Storage</strong>: Only stores references, not the whole tree, making updates and inserts simple.</li>
</ul>
<p>The <strong>Tree Pattern</strong> is ideal for representing organizational structures, menus, categories, or any nested, hierarchical data in MongoDB.</p>
<h2 id="6-subset-pattern">6. Subset Pattern</h2>
<h3 id="scenario-5">Scenario:</h3>
<p>You run a blog platform where each blog post can have <strong>hundreds or thousands of comments</strong>. When displaying the post detail page, you want to <strong>show only the top N (e.g., 5 or 10) comments</strong> to keep the page load fast and the UI clean, while still storing all comments for deeper browsing or moderation.</p>
<h3 id="applying-the-subset-pattern">Applying the Subset Pattern:</h3>
<ul>
<li>In your posts collection, each post document contains an array field (e.g., topComments) that holds just the first N comments (the “subset”).</li>
<li>The rest of the comments are stored separately, either in another collection (comments), or in another array, or are fetched via a paginated API.</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;_id&#34;</span>: <span style="color:#e6db74">&#34;post456&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;title&#34;</span>: <span style="color:#e6db74">&#34;10 Tips for MongoDB&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;content&#34;</span>: <span style="color:#e6db74">&#34;...&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;topComments&#34;</span>: [
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;user&#34;</span>: <span style="color:#e6db74">&#34;alice&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;text&#34;</span>: <span style="color:#e6db74">&#34;Great tips, thanks!&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;createdAt&#34;</span>: <span style="color:#e6db74">&#34;2025-06-24T09:00:00Z&#34;</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;user&#34;</span>: <span style="color:#e6db74">&#34;bob&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;text&#34;</span>: <span style="color:#e6db74">&#34;Helped me a lot.&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;createdAt&#34;</span>: <span style="color:#e6db74">&#34;2025-06-24T09:10:00Z&#34;</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// ... up to N comments
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  ],
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;commentsCount&#34;</span>: <span style="color:#ae81ff">250</span>  <span style="color:#75715e">// total comments
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span></code></pre></div><h3 id="advantages-5">Advantages:</h3>
<ul>
<li><strong>Performance</strong>: Quickly load and display the most relevant or recent comments without scanning all comments.</li>
<li><strong>UX</strong>: The user immediately sees a representative sample (“best” or “most recent”) comments.</li>
<li><strong>Scalability</strong>: Supports posts with large numbers of comments while keeping documents lean for the most common query.</li>
</ul>
<p>The <strong>Subset Pattern</strong> is ideal when you need to quickly access or display a <strong>small sample</strong> of a potentially large set of subdocuments, such as:</p>
<ul>
<li>Top reviews in a product listing,</li>
<li>Latest activities in a user’s feed,</li>
<li>Most recent messages in a chat preview.</li>
</ul>
<h2 id="7-approximation-pattern">7. Approximation Pattern</h2>
<h3 id="scenario-6">Scenario:</h3>
<p>Imagine you’re running a large social media platform (like Twitter or Instagram).
Some posts go viral and can get millions of likes in a very short time.
Storing and counting every single like accurately for real-time display is costly and can overload the database—especially when displaying lists of trending posts or feeds.</p>
<h3 id="applying-the-approximation-pattern">Applying the Approximation Pattern:</h3>
<p>Instead of keeping an exact, real-time count (which would require updating the main document for every single like), you store an approximate count that is:</p>
<ul>
<li>Fast to read and update</li>
<li>Close enough for display purposes</li>
<li>Periodically reconciled with the true value</li>
</ul>
<p>You might use an <strong>approximate counter</strong> (e.g., incrementing by batches, sampling, or using probabilistic algorithms like HyperLogLog for unique counts).</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;_id&#34;</span>: <span style="color:#e6db74">&#34;post888&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;content&#34;</span>: <span style="color:#e6db74">&#34;Look at this cute cat!&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;likeCountApprox&#34;</span>: <span style="color:#ae81ff">106500</span>,  <span style="color:#75715e">// Approximate!
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#f92672">&#34;lastRecountAt&#34;</span>: <span style="color:#e6db74">&#34;2025-06-25T13:00:00Z&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>Each time a like event is received, you <strong>don’t increment the counter immediately</strong> for every single event. Instead, you might:
<ul>
<li>Update the counter every 10, 100, or 1,000 likes (batching)</li>
<li>Use a lightweight cache or a message queue to aggregate increments</li>
<li>Occasionally <strong>recount the true number</strong> (e.g., every hour or when accuracy matters, like before a contest ends)</li>
</ul>
</li>
</ul>
<h3 id="advantages-6">Advantages:</h3>
<ul>
<li><strong>Performance</strong>: Dramatically reduces write load and document contention on very hot/viral data.</li>
<li><strong>Scalability</strong>: System easily handles bursts of high-volume events.</li>
<li><strong>User Experience</strong>: Users see counts that are &ldquo;good enough&rdquo; for social interaction and engagement.</li>
</ul>
<p>The Approximation Pattern is perfect when <strong>absolute precision isn’t needed in real time</strong>, but speed and scalability are crucial—especially for “hot” documents that change frequently and have high contention.</p>
<h2 id="8-outlier-pattern">8. Outlier Pattern</h2>
<h3 id="scenario-7">Scenario:</h3>
<p>Imagine you’re building a social networking platform where most users have a modest number of followers—say, under 1,000. You store follower user IDs in an array inside each user document for fast access:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;_id&#34;</span>: <span style="color:#e6db74">&#34;user123&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;AverageJoe&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;followers&#34;</span>: [<span style="color:#e6db74">&#34;userA&#34;</span>, <span style="color:#e6db74">&#34;userB&#34;</span>, <span style="color:#e6db74">&#34;userC&#34;</span>, <span style="color:#e6db74">&#34;...&#34;</span>]  <span style="color:#75715e">// usually a manageable size ~ 5K-10K entries
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span></code></pre></div><p>But, occasionally, you have <strong>outlier users</strong>—celebrities or influencers—who might have hundreds of thousands or millions of followers. Storing all those follower IDs in a single document would:</p>
<ul>
<li><strong>Bloat the document size</strong> (MongoDB’s document limit is 16MB)</li>
<li>Slow down updates</li>
<li>Impact performance for both reading and writing</li>
</ul>
<h3 id="applying-the-outlier-pattern">Applying the Outlier Pattern:</h3>
<ul>
<li>For <em>most users</em>, keep the follower array right in the main user document for simplicity and speed.</li>
<li>For <em>outlier users</em> (with huge arrays), <strong>split off</strong> the large follower list into a separate collection or multiple “bucket” documents, and just keep a reference in the main user document.</li>
</ul>
<p><strong>user collection:</strong>
<em>Regular User:</em></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;_id&#34;</span>: <span style="color:#e6db74">&#34;user123&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;AverageJoe&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;followers&#34;</span>: [<span style="color:#e6db74">&#34;userA&#34;</span>, <span style="color:#e6db74">&#34;userB&#34;</span>, <span style="color:#e6db74">&#34;userC&#34;</span>]  <span style="color:#75715e">// inline
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span></code></pre></div><p><em>Celebrity User (Outlier):</em></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;_id&#34;</span>: <span style="color:#e6db74">&#34;user999&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;FamousStar&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;followerBuckets&#34;</span>: [
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;followers_user999_1&#34;</span>, 
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;followers_user999_2&#34;</span>
</span></span><span style="display:flex;"><span>  ]
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="followerbuckets-collection">followerBuckets collection:</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;_id&#34;</span>: <span style="color:#e6db74">&#34;followers_user999_1&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;followers&#34;</span>: [<span style="color:#e6db74">&#34;userX&#34;</span>, <span style="color:#e6db74">&#34;userY&#34;</span>, <span style="color:#e6db74">&#34;userZ&#34;</span>, <span style="color:#e6db74">&#34;...&#34;</span>]  <span style="color:#75715e">// up to a manageable chunk
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span></code></pre></div><h3 id="advantages-7">Advantages:</h3>
<ul>
<li><strong>Performance</strong>: Keeps “normal” documents fast and small.</li>
<li><strong>Scalability</strong>: Supports rare, extreme outliers without hitting document size limits.</li>
<li><strong>Flexible</strong>: Handles the “big fish” in your data set without complicating your main document model.</li>
</ul>
<p>The <strong>Outlier Pattern</strong> is perfect when most data fits a simple model, but you occasionally have “giant” documents (outliers) that would otherwise break limits or kill performance—such as viral posts with millions of likes, super users, or anything with long-tail growth.</p>
<h2 id="9-polymorphic-pattern">9. Polymorphic Pattern</h2>
<h3 id="scenario-8">Scenario:</h3>
<p>Suppose you’re building a social app with an activity feed that can show many types of activities, such as:</p>
<ul>
<li>A user posts a status update</li>
<li>A user uploads a photo</li>
<li>A user likes a comment</li>
<li>A user follows another user
Each activity has some common fields (e.g., who performed the action, timestamp), but each type also has unique fields.</li>
</ul>
<h3 id="applying-the-polymorphic-pattern">Applying the Polymorphic Pattern:</h3>
<p>With the Polymorphic Pattern, each activity document contains the fields required for its type, along with a type (or activityType) field to describe which kind of activity it is.
This allows you to store all activity types in a single collection—simplifying queries and aggregations—while supporting a flexible schema for each activity type.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;_id&#34;</span>: <span style="color:#e6db74">&#34;activity1001&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;userId&#34;</span>: <span style="color:#e6db74">&#34;user123&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;timestamp&#34;</span>: <span style="color:#e6db74">&#34;2025-06-25T15:00:00Z&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;status_update&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;text&#34;</span>: <span style="color:#e6db74">&#34;Just got a new job!&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;_id&#34;</span>: <span style="color:#e6db74">&#34;activity1002&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;userId&#34;</span>: <span style="color:#e6db74">&#34;user123&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;timestamp&#34;</span>: <span style="color:#e6db74">&#34;2025-06-25T15:05:00Z&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;photo_upload&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;photoUrl&#34;</span>: <span style="color:#e6db74">&#34;media#image/pic123.jpg&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;caption&#34;</span>: <span style="color:#e6db74">&#34;Loving the new view!&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;_id&#34;</span>: <span style="color:#e6db74">&#34;activity1003&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;userId&#34;</span>: <span style="color:#e6db74">&#34;user234&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;timestamp&#34;</span>: <span style="color:#e6db74">&#34;2025-06-25T15:10:00Z&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;like&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;targetType&#34;</span>: <span style="color:#e6db74">&#34;comment&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;targetId&#34;</span>: <span style="color:#e6db74">&#34;comment789&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="advantages-8">Advantages:</h3>
<ul>
<li><strong>Single collection</strong> for all activities—easy to query, aggregate, and paginate.</li>
<li>Each document has <strong>fields specific to its type</strong> (polymorphism), saving space and improving clarity.</li>
<li><strong>Schema flexibility</strong>: Easy to add new activity types later without migration.</li>
</ul>
<p>The <strong>Polymorphic Pattern</strong> is perfect when you want to store documents of different “shapes” (but with some commonality) in a single collection—making it easy to manage, search, and display mixed-type data.</p>
<h2 id="10-extended-reference-pattern">10. Extended Reference Pattern</h2>
<h3 id="scenario-9">Scenario:</h3>
<p>Suppose you’re building an online store. Each order document references the products purchased. Normally, you might just store an array of product IDs in the order and fetch product details separately (classic referencing).
However, for performance and user experience, you want to show product previews (name, image, price) directly when viewing an order—<em>without extra database lookups</em>.</p>
<h3 id="applying-the-extended-reference-pattern">Applying the Extended Reference Pattern:</h3>
<p>With this pattern, the order document stores product references (IDs) alongside key product details (“extended” information). This way, the order always displays product snapshots as they appeared at purchase time—even if the main product collection changes later.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;_id&#34;</span>: <span style="color:#e6db74">&#34;order001&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;userId&#34;</span>: <span style="color:#e6db74">&#34;user123&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;createdAt&#34;</span>: <span style="color:#e6db74">&#34;2025-06-25T10:10:00Z&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;products&#34;</span>: [
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;productId&#34;</span>: <span style="color:#e6db74">&#34;prod789&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;Wireless Headphones&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;image&#34;</span>: <span style="color:#e6db74">&#34;media#images/headphones.jpg&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;price&#34;</span>: <span style="color:#ae81ff">99.99</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;qty&#34;</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;productId&#34;</span>: <span style="color:#e6db74">&#34;prod456&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;Bluetooth Speaker&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;image&#34;</span>: <span style="color:#e6db74">&#34;media#images/speaker.jpg&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;price&#34;</span>: <span style="color:#ae81ff">49.99</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;qty&#34;</span>: <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  ]
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="advantages-9">Advantages:</h3>
<ul>
<li><strong>Performance</strong>: No need for extra lookups when displaying orders—fast page loads.</li>
<li><strong>Data Consistency</strong>: The order reflects the product details at the time of purchase (important if product name/price changes later).</li>
<li><strong>UX</strong>: You can show product thumbnails, names, and prices right away in order history.</li>
</ul>
<p>The <strong>Extended Reference Pattern</strong> is perfect when you want to “cache” or “snapshot” important referenced data alongside IDs, balancing normalization with performance and data consistency.</p>
<h2 id="11-pre-aggregation-pattern">11. Pre-aggregation Pattern</h2>
<h3 id="scenario-10">Scenario:</h3>
<p>Suppose you run a popular blog platform with thousands of posts and millions of comments and likes.
You want to show <strong>real-time dashboards</strong> that display, for each post:</p>
<ul>
<li>Total number of comments</li>
<li>Total number of likes</li>
<li>Average rating</li>
<li>Calculating these values on the fly every time a user loads a dashboard would require scanning and aggregating massive collections, leading to <em>slow performance</em> and high database load.</li>
</ul>
<h3 id="applying-the-pre-aggregation-pattern">Applying the Pre-aggregation Pattern:</h3>
<p>With this pattern, you <strong>store summary statistics directly on the post document</strong> and keep them updated as new comments, likes, or ratings are added.
This way, your app can retrieve stats instantly, with no aggregation needed at read time.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;_id&#34;</span>: <span style="color:#e6db74">&#34;post999&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;title&#34;</span>: <span style="color:#e6db74">&#34;Scaling MongoDB for Millions&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;content&#34;</span>: <span style="color:#e6db74">&#34;...&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;commentCount&#34;</span>: <span style="color:#ae81ff">1823</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;likeCount&#34;</span>: <span style="color:#ae81ff">3450</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;averageRating&#34;</span>: <span style="color:#ae81ff">4.8</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="advantages-10">Advantages:</h3>
<ul>
<li><strong>Instant reads</strong>: Dashboards and lists load with a single, fast query.</li>
<li><strong>Low server load</strong>: No aggregation at query time, saving compute resources.</li>
<li><strong>Great for high-traffic apps</strong>: Performance stays fast, even as data grows.</li>
</ul>
<p>The <strong>Pre-aggregation Pattern</strong> is perfect for scenarios where you need real-time or frequent access to aggregate metrics, and where recalculating aggregates on every read would be slow or expensive.</p>
<h2 id="12-document-versioning-pattern">12. Document Versioning Pattern</h2>
<h3 id="scenario-11">Scenario:</h3>
<p>Suppose you’re building a wiki platform (like Wikipedia) where users can collaboratively edit pages.
You want to keep a history of all edits so users can:</p>
<ul>
<li>View previous versions</li>
<li>Restore an older version</li>
<li>See what changed and when</li>
</ul>
<h3 id="applying-the-document-versioning-pattern">Applying the Document Versioning Pattern:</h3>
<p>Instead of overwriting the existing wiki page document on each edit, you <strong>create a new versioned document</strong> for every update.
You can do this by:</p>
<ul>
<li>Adding a version field,</li>
<li>Storing all versions in the same collection, or</li>
<li>Keeping the latest version in the main collection and older versions in an “archive” collection.</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;_id&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;page123_v5&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;pageId&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;page123&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;version&#34;</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">5</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;title&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;History of Databases&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;content&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;...latest content...&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;editedBy&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;user321&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;editedAt&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;2025-06-25T10:30:00Z&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;_id&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;page123_v4&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;pageId&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;page123&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;version&#34;</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">4</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;title&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;History of Databases&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;content&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;...older content...&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;editedBy&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;user123&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;editedAt&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;2025-06-25T09:45:00Z&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="advantages-11">Advantages:</h3>
<ul>
<li><strong>Complete audit/history</strong>: Every change is tracked, with who/when/what.</li>
<li><strong>Easy rollbacks</strong>: Users can restore any previous version.</li>
<li><strong>Change tracking</strong>: View differences between versions for transparency.</li>
</ul>
<p>The <strong>Document Versioning Pattern</strong> is ideal whenever you need to preserve history, audit changes, or support rollbacks in collaborative or regulated environments.</p>
<h1 id="summary">Summary</h1>
<p>Understanding these 12 MongoDB design patterns—and when to apply each—can help you design scalable, maintainable, and high-performance applications. Choose the right pattern for your needs, and combine them when necessary for best results.</p>
<ul class="pa0">
  
   <li class="list di">
     <a href="/tags/mongodb/" class="link f5 grow br-pill ba ph3 pv2 mb2 dib black sans-serif no-underline">Mongodb</a>
   </li>
  
   <li class="list di">
     <a href="/tags/nosql/" class="link f5 grow br-pill ba ph3 pv2 mb2 dib black sans-serif no-underline">Nosql</a>
   </li>
  
   <li class="list di">
     <a href="/tags/design-pattern/" class="link f5 grow br-pill ba ph3 pv2 mb2 dib black sans-serif no-underline">Design Pattern</a>
   </li>
  
</ul>
<div class="mt6 instapaper_ignoref">
      
      
      </div>
    </div>

    <aside class="w-30-l mt6-l">




</aside>

  </article>

    </main>
    <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white white-70 dn dib-ns pv2 ph3 no-underline" href="https://lamthanhnguyen.github.io/" >
    &copy;  Liam Blogs 2025 
  </a>
    <div><div class="ananke-socials"><a href="http://linkedin.com/in/lam-thanh-nguyen-abcd6789" target="_blank" rel="noopener"
        class="ananke-social-link link-transition linkedin link dib z-999 pt3 pt0-l mr1"
        title="follow on LinkedIn - Opens in a new window"
        aria-label="follow on LinkedIn - Opens in a new window">
      <span class="icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc. --><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>
            
          </span></a></div>
</div>
  </div>
</footer>

  </body>
</html>
